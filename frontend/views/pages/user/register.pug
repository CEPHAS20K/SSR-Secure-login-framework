extends ../../layouts/base

include ../../components/navbar
include ../../components/button
include ../../components/form-controls
include ../../components/ui-shells

block content
  +appNavbar(activePage || "register")
  #authView.relative.overflow-x-hidden.overflow-y-auto.bg-auth-svg.min-h-dvh
    .pointer-events-none.absolute.-left-24.top-8.hidden.h-56.w-56.rounded-full.blur-3xl(
      class="bg-fuchsia-200/30 sm:block"
    )
    .pointer-events-none.absolute.-right-20.bottom-10.hidden.h-64.w-64.rounded-full.blur-3xl(
      class="bg-rose-200/35 sm:block"
    )

    .mx-auto.flex.w-full.max-w-4xl.items-start.justify-center.px-4.pt-24.pb-6(
      class="min-h-[calc(100dvh-6rem)] sm:items-center sm:min-h-[calc(100dvh-7rem)] sm:pt-28 sm:pb-8 md:px-6"
    )
      +authGlassCard("registerCard", "max-w-2xl p-5 sm:rounded-3xl sm:p-7 sm:my-auto")
        +authSectionTitle("Register", "", "registerTitle", "mb-6 text-center space-y-2", "font-headline leading-none text-rose-900 tracking-wide text-3xl sm:text-5xl", "mt-2 text-sm font-semibold text-rose-800", "font-family: 'Finger Paint', cursive")

        #registerFormShell.auth-form-shell.auth-form-loading
          .auth-form-skeleton(aria-hidden="true")
            .auth-skeleton-line.w-28
            .grid.grid-cols-1.gap-3.mt-2(class="sm:grid-cols-2")
              .auth-skeleton-block.h-11
              .auth-skeleton-block.h-11
            .grid.grid-cols-1.gap-3.mt-2(class="sm:grid-cols-2")
              .auth-skeleton-block.h-11
              .auth-skeleton-block.h-11
            .auth-skeleton-block.h-11.mt-2
            .auth-skeleton-block.h-11.mt-2
          form#registerForm.grid.gap-2(action="/auth/register", method="POST", class="md:grid-cols-2")
            +authFieldShell("username", "Username", "register-field space-y-1", "block text-xs font-bold uppercase tracking-wide text-rose-800")
              input#username.w-full.rounded-xl.border.px-3.border-rose-200.text-rose-950(
                type="text",
                name="username",
                autocomplete="username",
                placeholder="Enter username",
                required,
                class="py-2.5 bg-white/70 focus:border-primary focus:ring-2 focus:ring-primary"
              )

            +authFieldShell("regEmail", "Email", "register-field space-y-1", "block text-xs font-bold uppercase tracking-wide text-rose-800")
              input#regEmail.w-full.rounded-xl.border.px-3.border-rose-200.text-rose-950(
                type="email",
                name="email",
                autocomplete="email",
                placeholder="you@example.com",
                required,
                class="py-2.5 bg-white/70 focus:border-primary focus:ring-2 focus:ring-primary"
              )

            .register-field.space-y-1
              label.block.text-xs.font-bold.uppercase.tracking-wide.text-rose-800(
                for="regPassword"
              ) Password
              .relative
                input#regPassword.w-full.rounded-xl.border.px-3.pr-12.border-rose-200.text-rose-950(
                  type="password",
                  name="password",
                  autocomplete="new-password",
                  aria-describedby="registerCapsWarning",
                  placeholder="Min 8 chars",
                  required,
                  class="py-2.5 bg-white/70 focus:border-primary focus:ring-2 focus:ring-primary"
                )
                button#toggleRegPassword.absolute.right-2.rounded-md.px-2.py-1.text-xs.font-bold.text-rose-700.transition(
                  type="button",
                  class="top-1/2 -translate-y-1/2 hover:bg-fuchsia-100"
                ) Show
              p#registerCapsWarning.hidden.text-xs.font-semibold.text-rose-900(
                aria-live="polite",
                aria-hidden="true"
              ) Caps Lock is on

            .register-field.space-y-1
              label.block.text-xs.font-bold.uppercase.tracking-wide.text-rose-800(
                for="regPasswordConfirm"
              ) Confirm
              .relative
                input#regPasswordConfirm.w-full.rounded-xl.border.px-3.pr-12.border-rose-200.text-rose-950(
                  type="password",
                  name="confirmPassword",
                  autocomplete="new-password",
                  placeholder="Repeat pwd",
                  required,
                  class="py-2.5 bg-white/70 focus:border-primary focus:ring-2 focus:ring-primary"
                )
                button#toggleRegPasswordConfirm.absolute.right-2.rounded-md.px-2.py-1.text-xs.font-bold.text-rose-700.transition(
                  type="button",
                  class="top-1/2 -translate-y-1/2 hover:bg-fuchsia-100"
                ) Show

            .register-field.space-y-1
              label.block.text-xs.font-bold.uppercase.tracking-wide.text-rose-800(for="gender") Gender
              .relative.w-full
                select#gender.w-full.appearance-none.rounded-xl.border.px-3.pr-10.border-rose-200.text-rose-950(
                  name="gender",
                  autocomplete="sex",
                  required,
                  aria-describedby="genderHelp",
                  class="py-2.5 bg-white/70 focus:border-primary focus:ring-2 focus:ring-primary"
                )
                  option(value="") Select Gender
                  option(value="male") Male
                  option(value="female") Female
                  option(value="other") Other
                span.pointer-events-none.absolute.inset-y-0.right-3.flex.items-center.text-rose-700(
                  aria-hidden="true"
                ) â–¼
              p#genderHelp.hidden.text-xs.font-semibold.text-rose-800(aria-live="polite")

            .register-field.space-y-1
              label.block.text-xs.font-bold.uppercase.tracking-wide.text-rose-800(for="agreeTerms")
                | Terms
              label.flex.items-start.gap-2.rounded-lg.p-3(class="bg-white/55")
                input#agreeTerms.h-4.w-4.rounded.border-rose-300(
                  type="checkbox",
                  aria-describedby="termsHelp",
                  class="mt-0.5"
                )
                span.text-xs.font-semibold.text-rose-800
                  | I agree to the terms and privacy policy.
              p#termsHelp.hidden.text-xs.font-semibold.text-rose-800(aria-live="polite")

            .register-field.flex.justify-center(class="md:col-span-2")
              +appButton("Register", "primary", "submit")#registerBtn.py-3.px-8.min-w-36(
                disabled
              )

  +authModalShell("registerOtpModal")
    +authModalHeader("Verify Email OTP", "Enter the 5-digit code sent to your email.", "registerOtpClose")
    .mt-4.flex.items-center.justify-center.gap-2
      each digit in [0, 1, 2, 3, 4]
        input.register-otp-digit.w-12.rounded-xl.border.border-rose-200.px-3.py-2.text-center.text-lg.font-bold.text-rose-950.outline-none(
          type="text",
          maxlength="1",
          inputmode="numeric",
          pattern="[0-9]*",
          autocomplete="one-time-code",
          data-otp-digit,
          aria-label=`OTP digit ${digit + 1}`,
          class="bg-white/70 placeholder:text-rose-300 focus:border-primary focus:ring-2 focus:ring-primary/20"
        )
    .mt-5.flex.flex-col.gap-3(class="sm:flex-row sm:items-center sm:justify-between")
      +appButton("Submit", "primary", "button")#registerOtpSubmit.flex-1(disabled)
      +appButton("Resend (05:00)", "ghost", "button")#registerResendOtp.flex-1(disabled)

  script(src=assetPath("/js/pages/register.js"), type="module")
