extends ../../layouts/base

include ../../components/navbar
include ../../components/button

block content
  +appNavbar(activePage || "admin")
  #authView.relative.overflow-hidden.bg-auth-svg.min-h-dvh
    canvas#adminDashboardParticles.pointer-events-none.absolute.inset-0.z-0(data-auth-particles)
    .pointer-events-none.absolute.-left-20.top-12.hidden.h-64.w-64.rounded-full.blur-3xl(
      class="bg-fuchsia-200/30 sm:block"
    )
    .pointer-events-none.absolute.-right-16.bottom-16.hidden.h-72.w-72.rounded-full.blur-3xl(
      class="bg-orange-200/30 sm:block"
    )

    #adminDashboard.relative.z-10.mx-auto.w-full.max-w-7xl.px-4.pb-8.pt-24(class="sm:pt-28 md:px-6")
      #adminFlash.pointer-events-none.fixed.top-20.z-50.hidden.max-w-md.rounded-xl.border.px-4.py-3.text-sm.font-bold.shadow-xl(
        class="left-1/2 -translate-x-1/2 w-[92vw]"
      )
      #adminLoading.fixed.inset-0.z-50.hidden.items-center.justify-center.backdrop-blur-sm(
        class="bg-slate-900/35"
      )
        .h-12.w-12.animate-spin.rounded-full.border-4.border-t-white(class="border-white/30")

      .grid.gap-4(class="lg:grid-cols-[16rem_1fr]")
        aside.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
          p.text-xs.font-black.uppercase.text-rose-700(class="tracking-[0.18em]") Admin Suite
          h2.mt-2.font-headline.text-3xl.leading-none.text-rose-900 Dashboard
          nav#adminSidebarNav.mt-5.space-y-2
            a.block.rounded-lg.px-3.py-2.text-sm.font-bold.text-rose-900.transition(
              href="#overview",
              class="bg-white/55 hover:bg-white/75"
            ) Overview
            a.block.rounded-lg.px-3.py-2.text-sm.font-bold.text-rose-900.transition(
              href="#users",
              class="bg-white/35 hover:bg-white/60"
            ) User Management
            a.block.rounded-lg.px-3.py-2.text-sm.font-bold.text-rose-900.transition(
              href="#devices",
              class="bg-white/35 hover:bg-white/60"
            ) Devices
            a.block.rounded-lg.px-3.py-2.text-sm.font-bold.text-rose-900.transition(
              href="#risk",
              class="bg-white/35 hover:bg-white/60"
            ) Risk & Fraud
            a.block.rounded-lg.px-3.py-2.text-sm.font-bold.text-rose-900.transition(
              href="#logs",
              class="bg-white/35 hover:bg-white/60"
            ) Audit Logs
          .mt-5.space-y-2
            button#openUserLookupBtn.w-full.rounded-lg.border.px-3.py-2.text-sm.font-bold.transition.text-rose-900(
              type="button",
              class="border-white/45 bg-white/55 hover:bg-white/75"
            )
              span.inline-flex.items-center(class="gap-1.5")
                span.material-icons.text-sm.text-rose-700 search
                span Search Users
            p.text-xs.font-semibold.text-rose-800 Find user by username or email and export profile data.

        .space-y-4
          section#overview.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
            .flex.flex-col.gap-3(class="sm:flex-row sm:items-center sm:justify-between")
              .space-y-1
                p.text-xs.font-black.uppercase.text-rose-700(class="tracking-[0.18em]") Control Center
                h1.font-headline.text-4xl.leading-none.text-rose-900(class="sm:text-5xl") Admin Dashboard
                p.text-sm.font-semibold.text-rose-800 Monitor users, devices, anomalies, and critical actions.
              .flex.flex-wrap.items-center.gap-2
                label.text-xs.font-bold.text-rose-700(for="globalRangeSelect") Range
                select#globalRangeSelect.rounded-lg.border.px-2.py-1.text-xs.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                  class="focus:border-rose-300"
                )
                  option(value="7") Last 7d
                  option(value="30") Last 30d
                  option(value="90") Last 90d
                button#adminRefreshBtn.rounded-xl.border.px-4.py-2.text-sm.font-bold.text-rose-900.transition.border-rose-200(
                  type="button",
                  class="bg-white/70 hover:bg-white"
                ) Refresh
                form(action="/admin/logout", method="POST")
                  +appButton("Logout", "ghost", "submit")

            .mt-4.grid.gap-3(class="sm:grid-cols-2 xl:grid-cols-4")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Total Users
                p#metricTotalUsers.mt-1.text-3xl.font-black.text-rose-900 0
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Active Users
                p#metricActiveUsers.mt-1.text-3xl.font-black.text-rose-900 0
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Flagged Accounts
                p#metricFlaggedUsers.mt-1.text-3xl.font-black.text-rose-900 0
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Avg Risk Score
                p#metricAvgRisk.mt-1.text-3xl.font-black.text-rose-900 0

            .mt-3.grid.gap-3(class="sm:grid-cols-3")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Active Sessions
                p#metricActiveSessions.mt-1.text-3xl.font-black.text-rose-900 0
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Failed Logins (10m)
                p#metricFailedLogins10m.mt-1.text-3xl.font-black.text-rose-900 0
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Step-Up Queue
                p#metricStepUpQueue.mt-1.text-3xl.font-black.text-rose-900 0

            .mt-3.grid.gap-3(class="sm:grid-cols-3")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 API Latency (avg)
                p#metricApiLatency.mt-1.text-3xl.font-black.text-rose-900 0 ms
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Failed API Requests
                p#metricApiFailed.mt-1.text-3xl.font-black.text-rose-900 0
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Queue Backlog
                p#metricQueueBacklog.mt-1.text-3xl.font-black.text-rose-900 0

            .mt-4.grid.gap-3(class="lg:grid-cols-[1fr_20rem]")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                .flex.items-center.justify-between
                  p.text-sm.font-black.text-rose-900 Risk & Login Anomaly Trend
                  p#riskTrendHint.text-xs.font-semibold.text-rose-700 Last 7 days â€¢ click points to drill into logs
                svg#riskTrendChart.mt-3.h-44.w-full.rounded-lg(class="bg-white/70")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-sm.font-black.text-rose-900 Flagged For Step-Up
                ul#flaggedAccountsList.mt-2.space-y-2.text-sm.font-semibold.text-rose-800

            .mt-4.grid.gap-3(class="lg:grid-cols-[1fr_20rem]")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                .flex.items-center.justify-between
                  p.text-sm.font-black.text-rose-900 User Growth Trend
                  p#userGrowthHint.text-xs.font-semibold.text-rose-700 Last 6 months
                svg#userGrowthChart.mt-3.h-44.w-full.rounded-lg(class="bg-white/70")
              .rounded-xl.border.p-3(class="border-white/50 bg-white/65")
                p.text-sm.font-black.text-rose-900 Site Traffic
                dl.mt-2.grid.gap-1.text-sm.font-semibold.text-rose-900
                  .flex.items-center.justify-between.gap-2
                    dt.text-rose-700 Visits (7d)
                    dd#trafficTotalVisits 0
                  .flex.items-center.justify-between.gap-2
                    dt.text-rose-700 Success Rate
                    dd#trafficSuccessRate 0%
                  .flex.items-center.justify-between.gap-2
                    dt.text-rose-700 Unique IPs
                    dd#trafficUniqueIps 0
                  .flex.items-center.justify-between.gap-2
                    dt.text-rose-700 Countries
                    dd#trafficUniqueCountries 0
                svg#trafficTrendChart.mt-3.h-28.w-full.rounded-lg(class="bg-white/70")
                p.mt-2.font-semibold.text-rose-700(class="text-[11px]") Click points to filter audit logs.
                p.mt-3.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Threat Locations
                ul#threatGeoList.mt-2.space-y-1.text-xs.font-semibold.text-rose-900

          section#users.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
            .flex.items-center.justify-between
              h2.text-lg.font-black.text-rose-900 User Management
              p.text-xs.font-semibold.text-rose-700 Select a user for details and actions.
            .mt-2.grid.gap-2(class="md:grid-cols-[1fr_auto]")
              .relative
                span.material-icons.pointer-events-none.absolute.left-3(
                  class="top-1/2 -translate-y-1/2 text-rose-700/80"
                ) search
                input#usersTableSearch.w-full.rounded-lg.border.py-2.pl-10.pr-3.text-sm.font-semibold.text-rose-900.outline-none.transition(
                  type="search",
                  placeholder="Search users by username or email...",
                  class="border-white/45 bg-white/70 focus:border-rose-300"
                )
              .flex.flex-wrap.items-center.gap-2
                span#usersSelectionCount.text-xs.font-bold.text-rose-700 0 selected
                button#bulkActivateBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition.border-emerald-300.bg-emerald-50(
                  type="button",
                  class="hover:bg-emerald-100"
                ) Activate
                button#bulkDeactivateBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition.border-rose-300.bg-rose-50(
                  type="button",
                  class="hover:bg-rose-100"
                ) Deactivate
                button#bulkForceResetBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition.border-amber-300.bg-amber-50(
                  type="button",
                  class="hover:bg-amber-100"
                ) Force Reset
            .mt-3.overflow-x-auto.rounded-xl.border(class="border-white/45")
              table.min-w-full.text-left.text-sm
                thead.text-rose-900(class="bg-white/70")
                  tr
                    th.px-3.py-2.font-black
                      input#usersTableSelectAll(type="checkbox")
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="username",
                        class="hover:text-rose-700"
                      ) Username
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="email",
                        class="hover:text-rose-700"
                      ) Email
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="createdAt",
                        class="hover:text-rose-700"
                      ) Created
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="lastLogin",
                        class="hover:text-rose-700"
                      ) Last Login
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="riskScore",
                        class="hover:text-rose-700"
                      ) Risk
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="geo",
                        class="hover:text-rose-700"
                      ) Geo
                    th.px-3.py-2.font-black Device Trust
                    th.px-3.py-2.font-black
                      button.w-full.text-left.admin-users-sort(
                        type="button",
                        data-sort-by="active",
                        class="hover:text-rose-700"
                      ) Status
                    th.px-3.py-2.font-black Actions
                tbody#usersTableBody(class="bg-white/60")
            .mt-2.flex.items-center.justify-between.gap-2
              p#usersTableMeta.text-xs.font-semibold.text-rose-700 Showing 0 users
              .flex.items-center.gap-2
                button#usersTablePrevPage.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition(
                  type="button",
                  class="border-white/45 bg-white/65 hover:bg-white"
                ) Prev
                span#usersTablePageIndicator.text-xs.font-semibold.text-rose-700 Page 1/1
                button#usersTableNextPage.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition(
                  type="button",
                  class="border-white/45 bg-white/65 hover:bg-white"
                ) Next

          section#devices.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
            .flex.items-center.justify-between
              h2.text-lg.font-black.text-rose-900 User Devices & Session Monitoring
              p#selectedUserLabel.text-xs.font-semibold.text-rose-700 No user selected

            .mt-3.grid.gap-3(class="lg:grid-cols-[16rem_1fr]")
              .rounded-xl.border.p-3(class="border-white/45 bg-white/65")
                p.text-xs.font-black.uppercase.tracking-wider.text-rose-700 User Snapshot
                dl.mt-2.space-y-1.text-sm.font-semibold.text-rose-900
                  div
                    dt.inline.text-rose-700 Email:
                    dd#detailEmail.inline.ml-1 -
                  div
                    dt.inline.text-rose-700 Created:
                    dd#detailCreated.inline.ml-1 -
                  div
                    dt.inline.text-rose-700 Last Login:
                    dd#detailLastLogin.inline.ml-1 -
                  div
                    dt.inline.text-rose-700 Geo:
                    dd#detailGeo.inline.ml-1 -
                  div
                    dt.inline.text-rose-700 Risk:
                    dd#detailRisk.inline.ml-1 -
                .mt-3.grid.gap-2
                  button#forceResetBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                    type="button",
                    class="hover:bg-rose-50"
                  ) Force Password Reset
                  button#triggerOtpBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                    type="button",
                    class="hover:bg-rose-50"
                  ) Trigger OTP Re-auth
                  button#triggerWebauthnBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                    type="button",
                    class="hover:bg-rose-50"
                  ) Trigger WebAuthn Re-auth
                  button#viewTimelineBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                    type="button",
                    class="hover:bg-rose-50"
                  ) View User Timeline
                  button#incidentModeBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.text-white.transition.bg-rose-600(
                    type="button",
                    class="hover:bg-rose-700"
                  ) Incident Mode Lockdown

              .overflow-x-auto.rounded-xl.border(class="border-white/45")
                table.min-w-full.text-left.text-sm
                  thead.text-rose-900(class="bg-white/70")
                    tr
                      th.px-3.py-2.font-black Device
                      th.px-3.py-2.font-black Platform
                      th.px-3.py-2.font-black Last Seen
                      th.px-3.py-2.font-black IP / Geo
                      th.px-3.py-2.font-black Risk
                      th.px-3.py-2.font-black Signals
                      th.px-3.py-2.font-black Trust
                      th.px-3.py-2.font-black Action
                  tbody#devicesTableBody(class="bg-white/60")
              .mt-2.flex.items-center.justify-between.gap-2
                p#devicesTableMeta.text-xs.font-semibold.text-rose-700 Showing 0 devices
                .flex.items-center.gap-2
                  button#devicesTablePrevPage.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition(
                    type="button",
                    class="border-white/45 bg-white/65 hover:bg-white"
                  ) Prev
                  span#devicesTablePageIndicator.text-xs.font-semibold.text-rose-700 Page 1/1
                  button#devicesTableNextPage.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition(
                    type="button",
                    class="border-white/45 bg-white/65 hover:bg-white"
                  ) Next

          section#risk.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
            .flex.items-center.justify-between
              h2.text-lg.font-black.text-rose-900 Risk & Fraud Scoring
              p.text-xs.font-semibold.text-rose-700 Flagged users require step-up verification.
            .mt-3.overflow-x-auto.rounded-xl.border(class="border-white/45")
              table.min-w-full.text-left.text-sm
                thead.text-rose-900(class="bg-white/70")
                  tr
                    th.px-3.py-2.font-black Account
                    th.px-3.py-2.font-black Risk Score
                    th.px-3.py-2.font-black Anomalies
                    th.px-3.py-2.font-black Step-Up
                tbody#riskTableBody(class="bg-white/60")

          section#logs.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
            .flex.flex-col.gap-2(class="sm:flex-row sm:items-center sm:justify-between")
              h2.text-lg.font-black.text-rose-900 Audit Logs
              .flex.flex-wrap.gap-2
                button.admin-log-filter.rounded-lg.border.px-3.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                  type="button",
                  data-category="all",
                  class="py-1.5"
                ) All
                button.admin-log-filter.rounded-lg.border.px-3.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                  type="button",
                  data-category="login_attempt",
                  class="py-1.5"
                ) Login Attempts
                button.admin-log-filter.rounded-lg.border.px-3.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                  type="button",
                  data-category="otp",
                  class="py-1.5"
                ) OTP Events
                button.admin-log-filter.rounded-lg.border.px-3.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                  type="button",
                  data-category="admin_action",
                  class="py-1.5"
                ) Admin Actions

            .mt-3.overflow-x-auto.rounded-xl.border(class="border-white/45")
              table.min-w-full.text-left.text-sm
                thead.text-rose-900(class="bg-white/70")
                  tr
                    th.px-3.py-2.font-black Time
                    th.px-3.py-2.font-black Category
                    th.px-3.py-2.font-black Action
                    th.px-3.py-2.font-black Actor
                    th.px-3.py-2.font-black Target
                    th.px-3.py-2.font-black Status
                tbody#auditLogsBody(class="bg-white/60")

          section#operations.rounded-2xl.border.p-4.backdrop-blur-2xl(class="border-white/40 bg-white/20")
            .flex.items-center.justify-between
              h2.text-lg.font-black.text-rose-900 Governance & Exports
              p.text-xs.font-semibold.text-rose-700 Alerts, approvals, and reporting center.
            .mt-3.grid.gap-3(class="xl:grid-cols-2")
              .rounded-xl.border.p-3(class="border-white/45 bg-white/65")
                .flex.items-center.justify-between
                  p.text-sm.font-black.text-rose-900 Alert Rules
                  button#saveAlertRulesBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                    type="button",
                    class="hover:bg-rose-50"
                  ) Save
                .mt-2.grid.gap-2(class="sm:grid-cols-2")
                  label.text-xs.font-semibold.text-rose-800
                    span.block.mb-1 Failed Logins / 15m
                    input#ruleFailedLoginsThreshold.w-full.rounded-md.border.px-2.py-1.text-sm.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      type="number",
                      min="1",
                      class="focus:border-rose-300"
                    )
                  label.text-xs.font-semibold.text-rose-800
                    span.block.mb-1 High Risk Threshold
                    input#ruleHighRiskThreshold.w-full.rounded-md.border.px-2.py-1.text-sm.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      type="number",
                      min="1",
                      max="100",
                      class="focus:border-rose-300"
                    )
                  label.text-xs.font-semibold.text-rose-800
                    span.block.mb-1 Unique Countries / 24h
                    input#ruleCountryThreshold.w-full.rounded-md.border.px-2.py-1.text-sm.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      type="number",
                      min="1",
                      class="focus:border-rose-300"
                    )
                  label.flex.items-center.gap-2.mt-5.text-xs.font-semibold.text-rose-800
                    input#ruleEnabled(type="checkbox")
                    span Enable alerts
                p.mt-3.text-xs.font-black.uppercase.tracking-wider.text-rose-700 Triggered Alerts
                ul#triggeredAlertsList.mt-2.space-y-2.text-xs.font-semibold.text-rose-900
              .rounded-xl.border.p-3(class="border-white/45 bg-white/65")
                .flex.items-center.justify-between
                  p.text-sm.font-black.text-rose-900 Admin Action Approvals
                  label.flex.items-center.gap-2.text-xs.font-semibold.text-rose-800
                    input#requireApprovalToggle(type="checkbox")
                    span Require approval
                p.mt-2.text-xs.font-semibold.text-rose-700 Pending high-impact requests must be approved before execution.
                ul#approvalQueueList.mt-3.space-y-2.text-xs.font-semibold.text-rose-900
            .mt-3.grid.gap-3(class="xl:grid-cols-[1fr_22rem]")
              .rounded-xl.border.p-3(class="border-white/45 bg-white/65")
                .flex.items-center.justify-between
                  p.text-sm.font-black.text-rose-900 Export Center
                  span#exportHistoryCount.text-xs.font-semibold.text-rose-700 0 exports
                .mt-2.flex.flex-wrap.items-center.gap-2
                  select#exportPresetSelect.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                    class="focus:border-rose-300"
                  )
                    option(value="users_only") Users Overview
                    option(value="users_with_related") Users with Related Details
                  button#runPresetPdfBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-white.transition.bg-primary(
                    type="button",
                    class="hover:bg-secondary"
                  ) Run PDF
                  button#runPresetCsvBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-white.transition.bg-primary(
                    type="button",
                    class="hover:bg-secondary"
                  ) Run CSV
                .mt-3.overflow-x-auto.rounded-lg.border(class="border-white/45")
                  table.min-w-full.text-left.text-xs
                    thead.text-rose-900(class="bg-white/70")
                      tr
                        th.px-2.py-1.font-black Time
                        th.px-2.py-1.font-black Format
                        th.px-2.py-1.font-black Scope
                        th.px-2.py-1.font-black Records
                        th.px-2.py-1.font-black File
                        th.px-2.py-1.font-black Checksum
                    tbody#exportHistoryBody(class="bg-white/60")
              .rounded-xl.border.p-3(class="border-white/45 bg-white/65")
                p.text-sm.font-black.text-rose-900 Scheduled Export
                p#scheduledExportSummary.mt-2.text-xs.font-semibold.text-rose-800 No schedule configured.
                .mt-2.grid.gap-2(class="sm:grid-cols-2")
                  label.text-xs.font-semibold.text-rose-800(for="scheduledExportFrequency")
                    span.block.mb-1 Frequency
                    select#scheduledExportFrequency.w-full.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      class="focus:border-rose-300"
                    )
                      option(value="daily") Daily
                      option(value="weekly") Weekly
                  label.text-xs.font-semibold.text-rose-800(for="scheduledExportTime")
                    span.block.mb-1 Time (UTC)
                    input#scheduledExportTime.w-full.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      type="time",
                      class="focus:border-rose-300"
                    )
                  label.text-xs.font-semibold.text-rose-800(for="scheduledExportFormat")
                    span.block.mb-1 Format
                    select#scheduledExportFormat.w-full.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      class="focus:border-rose-300"
                    )
                      option(value="csv") CSV
                      option(value="pdf") PDF
                  label.text-xs.font-semibold.text-rose-800(for="scheduledExportScope")
                    span.block.mb-1 Scope
                    select#scheduledExportScope.w-full.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.outline-none.transition.border-rose-200.bg-white(
                      class="focus:border-rose-300"
                    )
                      option(value="users_only") Users only
                      option(value="users_with_related") Users with related
                label.mt-2.block.text-xs.font-semibold.text-rose-800(for="scheduledExportEnabled")
                  input#scheduledExportEnabled.mr-2(type="checkbox")
                  | Enable daily export reminder
                .mt-2.flex.flex-wrap.gap-2
                  button#scheduledExportSaveBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-rose-900.transition.border-rose-200.bg-white(
                    type="button",
                    class="hover:bg-rose-50"
                  ) Save Schedule
                  button#scheduledExportRunNowBtn.rounded-md.border.px-2.py-1.text-xs.font-bold.text-white.transition.border-rose-200.bg-primary(
                    type="button",
                    class="hover:bg-secondary"
                  ) Run Now
                p.mt-2.font-semibold.text-rose-700(class="text-[11px]") Scheduled exports include checksum and file naming for compliance traceability.

  #adminActionModal.fixed.inset-0.z-50.hidden.items-center.justify-center.p-4.backdrop-blur-sm(
    class="bg-slate-900/50"
  )
    .w-full.max-w-md.rounded-2xl.border.p-4.shadow-2xl.bg-white(class="border-white/40")
      h3#adminModalTitle.text-lg.font-black.text-rose-900 Confirm Action
      p#adminModalMessage.mt-2.text-sm.font-semibold.text-rose-800 Are you sure?
      .mt-4.flex.gap-2
        button#adminModalCancel.flex-1.rounded-lg.border.px-3.py-2.text-sm.font-bold.text-rose-900.transition.border-rose-200.bg-white(
          type="button",
          class="hover:bg-rose-50"
        ) Cancel
        button#adminModalConfirm.flex-1.rounded-lg.bg-primary.px-3.py-2.text-sm.font-bold.text-white.transition(
          type="button",
          class="hover:bg-secondary"
        ) Confirm

  #adminUserLookupModal.fixed.inset-0.z-50.hidden.items-center.justify-center.p-4.backdrop-blur-sm(
    class="bg-rose-950/30"
  )
    .w-full.max-w-4xl.rounded-2xl.border.p-4.shadow-2xl.backdrop-blur-2xl(
      class="border-white/40 bg-white/20"
    )
      .flex.items-start.justify-between.gap-3
        .space-y-1
          h3.text-lg.font-black.text-rose-900 User Search
          p.text-sm.font-semibold.text-rose-800 Search by username or email, review profile details, and export.
        button#userLookupCloseBtn.rounded-lg.border.px-3.text-xs.font-bold.text-rose-900.transition(
          type="button",
          class="border-white/45 bg-white/65 py-1.5 hover:bg-white"
        ) Close
      .mt-3
        .relative
          span.material-icons.pointer-events-none.absolute.left-3(
            class="top-1/2 -translate-y-1/2 text-rose-700/80"
          ) search
          input#userLookupInput.w-full.rounded-lg.border.py-2.pl-11.pr-3.text-sm.font-semibold.text-rose-900.outline-none.transition(
            type="search",
            placeholder="Search username or email...",
            class="border-white/45 bg-white/70 focus:border-rose-300"
          )
      .mt-3.grid.gap-3(class="md:grid-cols-[16rem_1fr]")
        .rounded-xl.border.backdrop-blur-xl(class="border-white/45 bg-white/55")
          p.border-b.px-3.py-2.text-xs.font-black.uppercase.text-rose-700.tracking-wider(
            class="border-white/45"
          ) Matches
          #userLookupResults.max-h-72.overflow-y-auto.p-2.space-y-2
          .border-t.px-2.py-2(class="border-white/45")
            .flex.items-center.justify-between.gap-2
              p#userLookupMeta.font-semibold.text-rose-700(class="text-[11px]") Showing 0 users
              .flex.items-center.gap-2
                button#userLookupPrevPage.rounded-md.border.px-2.py-1.font-bold.text-rose-900.transition(
                  type="button",
                  class="border-white/45 bg-white/65 text-[11px] hover:bg-white"
                ) Prev
                span#userLookupPageIndicator.font-semibold.text-rose-700(class="text-[11px]") Page 1/1
                button#userLookupNextPage.rounded-md.border.px-2.py-1.font-bold.text-rose-900.transition(
                  type="button",
                  class="border-white/45 bg-white/65 text-[11px] hover:bg-white"
                ) Next
        .rounded-xl.border.p-3.backdrop-blur-xl(class="border-white/45 bg-white/55")
          p.text-xs.font-black.uppercase.text-rose-700.tracking-wider User Details
          #userLookupDetails.mt-2.text-sm.font-semibold.text-rose-900 Select a user to view details.
          .mt-3.flex.flex-wrap.gap-2
            button#userLookupExportPdfBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.transition.text-white.bg-primary(
              type="button",
              class="border-white/45 hover:bg-secondary"
            ) Export Selected PDF
            button#userLookupExportCsvBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.transition.text-white.bg-primary(
              type="button",
              class="border-white/45 hover:bg-secondary"
            ) Export Selected CSV
            button#userLookupCancelBtn.rounded-lg.border.px-3.py-2.text-xs.font-bold.text-rose-900.transition(
              type="button",
              class="border-white/45 bg-white/65 hover:bg-white"
            ) Close

  #adminUsersExportModal.fixed.inset-0.z-50.hidden.items-center.justify-center.p-4.backdrop-blur-sm(
    class="bg-rose-950/30"
  )
    .w-full.max-w-lg.rounded-2xl.border.p-4.shadow-2xl.backdrop-blur-2xl(
      class="border-white/40 bg-white/20"
    )
      h3#usersExportTitle.text-lg.font-black.text-rose-900 Export Users
      p#usersExportSubtitle.mt-1.text-sm.font-semibold.text-rose-800 Configure export scope before download.
      label.mt-3.block.text-xs.font-black.uppercase.text-rose-700.tracking-wider(
        for="usersExportScope"
      ) Export Scope
      select#usersExportScope.mt-1.w-full.rounded-lg.border.px-3.py-2.text-sm.font-semibold.text-rose-900.outline-none.transition(
        class="border-white/45 bg-white/70 focus:border-rose-300"
      )
        option(value="users_only") Users only (profile overview)
        option(value="users_with_related") Users with related details (devices, anomaly and risk context)
      ul#usersExportScopeDetails.mt-3.space-y-1.text-xs.font-semibold.text-rose-900
      .mt-4.flex.gap-2
        button#usersExportCancelBtn.flex-1.rounded-lg.border.px-3.py-2.text-sm.font-bold.text-rose-900.transition(
          type="button",
          class="border-white/45 bg-white/65 hover:bg-white"
        ) Cancel
        button#usersExportConfirmBtn.flex-1.rounded-lg.bg-primary.px-3.py-2.text-sm.font-bold.text-white.transition(
          type="button",
          class="hover:bg-secondary"
        ) Export

  #adminTimelineModal.fixed.inset-0.z-50.hidden.items-center.justify-center.p-4.backdrop-blur-sm(
    class="bg-rose-950/30"
  )
    .w-full.max-w-3xl.rounded-2xl.border.p-4.shadow-2xl.backdrop-blur-2xl(
      class="border-white/40 bg-white/20"
    )
      .flex.items-start.justify-between.gap-2
        .space-y-1
          h3.text-lg.font-black.text-rose-900 User Activity Timeline
          p#timelineUserLabel.text-sm.font-semibold.text-rose-800 Select a user to inspect timeline.
        button#timelineCloseBtn.rounded-lg.border.px-3.py-1.text-xs.font-bold.text-rose-900.transition(
          type="button",
          class="border-white/45 bg-white/65 hover:bg-white"
        ) Close
      #timelineLoading.mt-3.hidden.text-xs.font-bold.text-rose-700 Loading timeline...
      #timelineList.mt-3.overflow-y-auto.space-y-2.text-sm.font-semibold.text-rose-900(
        class="max-h-[24rem]"
      )

  script#adminInitialData(type="application/json") !{ JSON.stringify(dashboardData || {}) }
  script(src=assetPath("/js/animations/login-particles.js"), defer)
  script(src=assetPath("/vendor/axios.min.js"), defer)
  script(src=assetPath("/js/admin-dashboard.js"), defer)
