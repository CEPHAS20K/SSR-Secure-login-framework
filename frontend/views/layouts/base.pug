doctype html
html(lang="en")
  -
    const currentPage = typeof page === "string" ? page : "";
    const gsapPages = new Set(["landing", "login", "register", "admin-login", "error"]);
    const shouldLoadGsap = gsapPages.has(currentPage);
    const shouldPreloadLandingVisuals = currentPage === "landing";
    const preloadFontHrefs = ["/fonts/inter-latin-400.woff2"];

    if (currentPage === "landing") {
      preloadFontHrefs.push("/fonts/cabin-sketch-latin-700.woff2", "/fonts/schoolbell-latin-400.woff2");
    } else if (currentPage === "login" || currentPage === "register" || currentPage === "admin-login") {
      preloadFontHrefs.push("/fonts/finger-paint-latin-400.woff2", "/fonts/schoolbell-latin-400.woff2");
    } else if (currentPage === "admin-dashboard") {
      preloadFontHrefs.push("/fonts/bebas-neue-latin-400.woff2");
    }
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    meta(name="theme-color", content="#ff7700")
    meta(name="mobile-web-app-capable", content="yes")
    meta(name="apple-mobile-web-app-status-bar-style", content="black-translucent")
    meta(name="apple-mobile-web-app-title", content="Secure Storage Vault")
    title Secure Storage Vault
    link(rel="icon", type="image/png", sizes="32x32", href=assetPath("/images/favicon-32.png"))
    link(rel="icon", type="image/png", sizes="16x16", href=assetPath("/images/favicon-16.png"))
    link(rel="apple-touch-icon", sizes="32x32", href=assetPath("/images/favicon-32.png"))
    link(rel="manifest", href=assetPath("/manifest.webmanifest"))
    if shouldPreloadLandingVisuals
      link(
        rel="preload",
        as="image",
        href=assetPath("/images/land.svg"),
        type="image/svg+xml",
        fetchpriority="high"
      )
    each fontHref in preloadFontHrefs
      link(rel="preload", as="font", type="font/woff2", href=fontHref, crossorigin="anonymous")
    script.
      (function () {
        try {
          if (sessionStorage.getItem("auth_nav_transition") === "1") {
            document.documentElement.setAttribute("data-nav-transition", "1");
          }
        } catch (error) {}
      })();
    link(rel="stylesheet", href=assetPath("/css/fonts.css"))
    link(rel="stylesheet", href=assetPath("/vendor/notyf.min.css"))
    style.
      html,
      body {
        background: #ff7700;
      }
      #pageTransitionOverlay {
        position: fixed;
        inset: 0;
        z-index: 60;
        pointer-events: none;
        visibility: hidden;
        opacity: 1;
        clip-path: polygon(0% 0%, 0% 0%, 0% 100%, 0% 100%);
        background: linear-gradient(160deg, #ff7700 0%, #ba274b 55%, #a62a95 100%);
      }
      #pageTransitionStroke {
        position: absolute;
        inset: 0 auto 0 0;
        width: 2px;
        opacity: 0;
        background: linear-gradient(180deg, rgba(255, 248, 237, 0.94) 0%, rgba(255, 170, 106, 0.96) 100%);
        box-shadow: 0 0 22px rgba(255, 220, 173, 0.85);
      }
      html[data-nav-transition="1"] #pageTransitionOverlay {
        visibility: visible;
        clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
      }
      html[data-nav-transition="1"] #pageTransitionStroke {
        opacity: 1;
        transform: translateX(calc(100vw - 2px));
      }
    link(rel="stylesheet", href=assetPath("/css/output.css"))
  body.min-h-screen.bg-slate-100.font-body.text-slate-900(data-page=page || "")
    #pageTransitionOverlay
      #pageTransitionStroke
    #appToastRegion.pointer-events-none.fixed.inset-x-0.top-16.mx-auto.flex.w-full.max-w-md.flex-col.gap-2.px-3(
      class="z-[90]",
      aria-live="polite",
      aria-atomic="false"
    )
    script(src=assetPath("/vendor/notyf.min.js"))
    main
      block content
    if shouldLoadGsap
      script(src=assetPath("/vendor/gsap.min.js"), defer)
    if rumEnabled
      script(src=assetPath("/js/web-vitals-rum.js"), type="module")
    script(src=assetPath("/js/animations/navbar.js"), defer)
    script(src=assetPath("/js/animations.js"), defer)
    script(src=assetPath("/js/link-prefetch.js"), defer)
    script(src=assetPath("/js/sw-register.js"), defer)
    script(src=assetPath("/js/pwa-install-prompt.js"), defer)
